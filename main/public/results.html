<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concept Album Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            /* Primary Colors */
            --primary-bg: #1e1e1e; /* Dark background */
            --primary-text: #FFFFFF; /* Main text color */
            --primary-accent: #e93424; /* Accent color (e.g., buttons, links) */
            --primary-hover-accent: #da8396;
            
            /* Secondary Colors */
            --secondary-bg: #140f0f; /* Secondary background (e.g., album cover, progress bar) */
            --secondary-text: #9CA3AF; /* Secondary text color (e.g., details) */
            --secondary-accent: #4b4b4b; /* Secondary accent (e.g., hovered buttons) */
            
            /* Misc Colors */
            --tooltip-bg: rgba(0, 0, 0, 0.8);
            --tooltip-text: #FFFFFF;
            --disabled-bg: rgba(107, 114, 128, 0.8);
            --hover-bg: #1555bb; /* Background color on hover */
            --hover-text: #D1D5DB; /* Text color on hover */
        }

        body {
            background-color: var(--primary-bg);
        }

        .hidden {
            background-color: var(--secondary-bg);
        }


        #album-content {
            background-color: var(--secondary-bg);
        }

        .tooltip {
            position: absolute;
            background-color: var(--tooltip-bg);
            color: var(--tooltip-text);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 50;
            max-width: 50%;
            word-wrap: break-word;
        }

        .side-button {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--primary-accent);
            color: var(--primary-text);
            width: 50px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: background-color 0.3s;
            z-index: 40;
        }

        .side-button:hover {
            background-color: var(--primary-hover-accent);
            color: var(--hover-text);
        }

        .side-button:disabled {
            background-color: var(--disabled-bg);
            cursor: not-allowed;
        }

        #prevButton {
            left: 20%;
            border-radius: 0 8px 8px 0;
        }

        #nextButton {
            right: 20%;
            border-radius: 8px 0 0 8px;
        }

        .player-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--primary-bg);
            padding: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .player-icon {
            cursor: pointer;
            transition: color 0.3s;
        }

        .player-icon:hover {
            color: var(--primary-accent);
        }

        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background-color: var(--secondary-bg);
        }

        .progress {
            width: 30%;
            height: 100%;
            background-color: var(--primary-accent);
        }

        .album-cover {
            width: 100%;
            padding-bottom: 100%; /* this makes it square */
            background-color: var(--secondary-accent);
            position: relative;
        }

        .song-element {
            display: flex;
            align-items: center;
            padding: 8px;
            transition: background-color 0.3s, color 0.3s;
        }

        .song-element:hover {
            background-color: var(--hover-bg);
            color: var(--hover-text);
        }

        @media (max-width: 768px) {
            .side-button {
                width: 40px;
                height: 80px;
            }

            #prevButton {
                left: 0%;
            }

            #nextButton {
                right: 0%;
            }
        }
    </style>
</head>
<body class="bg-primary-bg text-primary-text">
    <div class="flex flex-col md:flex-row">
        <div class="hidden md:block w-1/5 bg-secondary-bg h-screen p-4 fixed left-0 top-0 overflow-y-auto">
            <!-- sidebar left (hidden on mobile) -->
        </div>

        <!-- content: full width on mobile, adjusted for desktop -->
        <div class="w-full md:w-3/5 p-4 md:p-8 md:ml-[20%] mb-24">
            <div id="loading" class="text-white	text-center text-2xl">Loading...
                <!-- to insert ads here eventually -->
            </div>

            <div id="albumContent" class="hidden">
                <!-- album header -->
                <div class="flex flex-col md:flex-row mb-8">
                    <div class="w-full md:w-64 mb-4 md:mb-0 md:mr-8">
                        <div class="album-cover"></div>
                    </div>
                    <div>
                        <h2 id="albumTitle" class="text-white text-2xl md:text-3xl font-bold mb-2"></h2>
                        <p id="albumDetails" class="text-white text-secondary-text"></p>
                    </div>
                </div>

                <!-- songs -->
                <div id="songList" class="text-white space-y-2"></div>
            </div>
        </div>

        <div class="hidden md:block w-1/5 bg-secondary-bg h-screen p-4 fixed right-0 top-0 overflow-y-auto">
            <!-- sidebar right (hidden on mobile) -->
        </div>
    </div>

    <!-- buttons -->
    <button id="prevButton" class="side-button" disabled>←</button>
    <button id="nextButton" class="side-button" disabled>→</button>

    <!-- player bar -->
    <div class="player-bar">
        <div class="player-controls">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 player-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 player-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953l7.108-4.062A1.125 1.125 0 0121 8.688v8.123zM11.25 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953L9.567 7.71a1.125 1.125 0 011.683.977v8.123z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 player-icon" id="share-button">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 player-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 player-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
            </svg>
        </div>
        <div class="progress-bar">
            <div class="progress"></div>
        </div>
    </div>

    <script>
        const albumContent = document.getElementById('albumContent');
        const loading = document.getElementById('loading');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const shareButton = document.getElementById('share-button');

        let contentResponses = [];
        let currentIndex = 0;

        async function fetchData() {
            try {
                const response = await fetch('/artists');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data:', error);
                throw error;
            }
        }

        function displayAlbum() {
            const albumData = contentResponses[currentIndex];

            document.getElementById('albumTitle').textContent = albumData.title.slice(1, -1);

            const artists = albumData.pair.split("`");

            const songList = document.getElementById('songList');
            songList.innerHTML = '';
            albumData.finalized_tracks.forEach((track, index) => {
                const track_details = track.split("|");
                
                const songElement = document.createElement('div');
                songElement.className = 'song-element hover:bg-hover-bg rounded';
                songElement.innerHTML = `
                    <span class="w-8 text-right mr-4 text-secondary-text">${index + 1}</span>
                    <div class="flex-grow">
                        <p class="font-normal">${track_details[0]}</p>
                    </div>
                    <span class="text-secondary-text song-runtime">3:30</span>
                `;
                // Add event listeners for tooltip
                songElement.addEventListener('mouseenter', (e) => {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = track_details[1] || 'No description available';
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY + 10}px`;
                    document.body.appendChild(tooltip);
                });

                songElement.addEventListener('mouseleave', () => {
                    const tooltip = document.querySelector('.tooltip');
                    if (tooltip) {
                        tooltip.remove();
                    }
                });
                songList.appendChild(songElement);
            });

            document.getElementById('albumDetails').textContent = `${artists[0]} & ${artists[1]} • ${albumData.finalized_tracks.length} songs`;

            albumContent.classList.remove('hidden');
            updateNavigation();
        }

        function updateNavigation() {
            prevButton.disabled = currentIndex === 0;
            nextButton.disabled = currentIndex === contentResponses.length - 1;
        }

        prevButton.addEventListener('click', () => {
            if (currentIndex > 0) {
                currentIndex--;
                displayAlbum();
            }
        });

        nextButton.addEventListener('click', () => {
            if (currentIndex < contentResponses.length - 1) {
                currentIndex++;
                displayAlbum();
            }
        });

        function generateCustomGraphic(albumData) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // Set canvas size (mobile phone aspect ratio, 9:16)
            canvas.width = 1080;
            canvas.height = 1920;

            // Set background
            ctx.fillStyle = '#140f0e';  // Dark background (--primary-bg)
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Helper function to draw rounded rectangles
            function roundRect(x, y, w, h, radius) {
                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.arcTo(x + w, y, x + w, y + h, radius);
                ctx.arcTo(x + w, y + h, x, y + h, radius);
                ctx.arcTo(x, y + h, x, y, radius);
                ctx.arcTo(x, y, x + w, y, radius);
                ctx.closePath();
            }

            // Draw top bar with back button and options
            ctx.fillStyle = '#1e1e1e';
            ctx.fillRect(0, 0, canvas.width, 120);
            
            // Back button
            ctx.strokeStyle = '#ea3223';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(40, 60);
            ctx.lineTo(80, 40);
            ctx.lineTo(80, 80);
            ctx.closePath();
            ctx.stroke();

            // Options dots
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.arc(canvas.width - 40 - i * 30, 60, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#ea3223';
                ctx.fill();
            }

            // Album cover placeholder
            ctx.fillStyle = '#3e3e3e';
            roundRect(40, 160, canvas.width - 80, canvas.width - 80, 20);
            ctx.fill();

            // Album title
            ctx.font = 'bold 48px Arial';
            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'center';
            ctx.fillText(albumData.title.slice(1, -1) , canvas.width / 2, canvas.width + 140, canvas.width - 80);

            // Artist name
            ctx.font = '32px Arial';
            ctx.fillStyle = '#b3b3b3';
            const pair = albumData.pair.split("`");
            ctx.fillText(pair[0] + " & " + pair[1], canvas.width / 2, canvas.width + 190, canvas.width - 80);

            // Track list
            const trackListStart = canvas.width + 240;
            const trackHeight = 80;
            ctx.font = '36px Arial';
            ctx.textAlign = 'left';
            ctx.fillStyle = '#ffffff';

            albumData.finalized_tracks.forEach((track, index) => {
                const track_details = track.split("|")[0];

                const y = trackListStart + index * trackHeight;
                ctx.fillStyle = '#ea3223';
                ctx.fillText(`${index + 1}`, 40, y);
                ctx.fillStyle = '#ffffff';
                ctx.fillText(track_details, 100, y, canvas.width - 140);
            });

            // // Player controls
            // const controlsY = canvas.height - 150;
            
            // // Progress bar
            // ctx.fillStyle = '#3e3e3e';
            // ctx.fillRect(40, controlsY, canvas.width - 80, 6);
            // ctx.fillStyle = '#ea3223';  
            // ctx.fillRect(40, controlsY, (canvas.width - 80) * 0.3, 6);

            // // Play button
            // ctx.beginPath();
            // ctx.arc(canvas.width / 2, controlsY + 60, 40, 0, Math.PI * 2);
            // ctx.fillStyle = '#ea3223';
            // ctx.fill();
            // ctx.fillStyle = '#140f0e';
            // ctx.beginPath();
            // ctx.moveTo(canvas.width / 2 - 10, controlsY + 45);
            // ctx.lineTo(canvas.width / 2 - 10, controlsY + 75);
            // ctx.lineTo(canvas.width / 2 + 20, controlsY + 60);
            // ctx.closePath();
            // ctx.fill();

            // // Previous and Next buttons
            // [canvas.width / 2 - 120, canvas.width / 2 + 120].forEach((x, i) => {
            //     ctx.beginPath();
            //     ctx.moveTo(x + (i ? -15 : 15), controlsY + 60);
            //     ctx.lineTo(x + (i ? 15 : -15), controlsY + 45);
            //     ctx.lineTo(x + (i ? 15 : -15), controlsY + 75);
            //     ctx.closePath();
            //     ctx.fillStyle = '#140f0e';
            //     ctx.fill();
            // });

        //     return canvas.toDataURL('image/png');
        // }
            // Player controls
            const controlsY = canvas.height - 150;
            
            // Progress bar
            ctx.fillStyle = '#3e3e3e';
            ctx.fillRect(40, controlsY, canvas.width - 80, 6);
            ctx.fillStyle = '#ea3223';  
            ctx.fillRect(40, controlsY, (canvas.width - 80) * 0.3, 6);

            // Helper function to draw SVG path
            function drawSVGPath(path, x, y, scale = 1) {
                ctx.save();
                ctx.translate(x, y);
                ctx.scale(scale, scale);
                const p = new Path2D(path);
                ctx.stroke(p);
                ctx.restore();
            }

            // Set common styles for icons
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 1.5;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // Shuffle icon
            drawSVGPath("M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3", canvas.width / 2 - 200, controlsY + 60, 1);

            // Previous track icon
            drawSVGPath("M21 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953l7.108-4.062A1.125 1.125 0 0121 8.688v8.123zM11.25 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953L9.567 7.71a1.125 1.125 0 011.683.977v8.123z", canvas.width / 2 - 120, controlsY + 60, 1);

            // Play/Pause icon
            drawSVGPath("M21 12a9 9 0 11-18 0 9 9 0 0118 0z M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z", canvas.width / 2, controlsY + 60, 1.33);

            // Next track icon
            drawSVGPath("M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z", canvas.width / 2 + 120, controlsY + 60, 1);

            // Repeat icon
            drawSVGPath("M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99", canvas.width / 2 + 200, controlsY + 60, 1);

            return canvas.toDataURL('image/png');
        }
        
        
        function downloadImage(imageData, fileName) {
            const link = document.createElement('a');
            link.href = imageData;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Update share button click handler
        shareButton.addEventListener('click', () => {
            const currentAlbumData = contentResponses[currentIndex];
            const imageData = generateCustomGraphic(currentAlbumData);
            downloadImage(imageData, 'blondey.png');
        });

        async function init() {
            try {
                contentResponses = await fetchData();
                loading.classList.add('hidden');
                displayAlbum();
            } catch (error) {
                console.error('Error fetching data:', error);
                
                loading.innerHTML = '';
                
                const errorMessage = document.createElement('p');
                errorMessage.textContent = 'Error loading data. Please try again later.';
                errorMessage.className = 'text-center text-2xl mb-4';
                loading.appendChild(errorMessage);
                
                const homeButton = document.createElement('button');
                homeButton.textContent = 'Go to Home Page';
                homeButton.className = 'block mx-auto bg-primary-accent hover:bg-primary-hover-accent text-primary-text font-bold py-2 px-4 rounded transition duration-300';
                homeButton.addEventListener('click', () => {
                    window.location.href = window.location.origin;
                });
                
                loading.appendChild(homeButton);
                
                loading.classList.remove('hidden');
            }
        }

        init();
    </script>
</body>
</html>