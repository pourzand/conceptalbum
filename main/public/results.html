<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concept Album Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 10;
            max-width: 50%;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="flex">
        <!-- Sidebar (now fixed) -->
        <div class="w-1/5 bg-gray-800 h-screen p-4 fixed left-0 top-0 overflow-y-auto">
            <!-- Sidebar content (empty for now) -->
        </div>

        <!-- Main content (adjusted to account for fixed sidebar) -->
        <div class="w-4/5 p-8 ml-[20%]">
            <h1 class="text-4xl font-bold mb-8 text-center">Concept Album Results</h1>
            <div id="loading" class="text-center text-2xl">Loading...</div>

            <div id="albumContent" class="hidden">
                <!-- Album header -->
                <div class="flex mb-8">
                    <div class="w-64 h-64 bg-gray-700 mr-8">
                        <!-- Album cover placeholder -->
                    </div>
                    <div>
                        <h2 id="albumTitle" class="text-3xl font-bold mb-2"></h2>
                        <p id="albumDetails" class="text-gray-400"></p>
                    </div>
                </div>

                <!-- Song list -->
                <div id="songList" class="space-y-2"></div>
            </div>

            <!-- Navigation buttons -->
            <div class="flex justify-center mt-8 space-x-4">
                <button id="prevButton" class="bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-500" disabled>←</button>
                <button id="nextButton" class="bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-500" disabled>→</button>
            </div>
        </div>
    </div>

    <script>
        const albumContent = document.getElementById('albumContent');
        const loading = document.getElementById('loading');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');

        let contentResponses = [];
        let currentIndex = 0;

        async function fetchData() {
            try {
                const response = await fetch('/artists');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data:', error);
                throw error;
            }
        }

        function parseAlbumResponse(response) {

            const lines = response.split('\n');
            console.log(lines);
            const pair = lines[0].trim();
            const title = lines[1].trim();
            const tracks = lines.slice(2).map(line => line.trim()).filter(line => line !== '');
            return { title, tracks, pair };
        }

        function displayAlbum() {
            const albumData = parseAlbumResponse(contentResponses[currentIndex]);
            
            document.getElementById('albumTitle').textContent = albumData.title.slice(1, -1);
            const artists =  albumData.pair.split(",");

            document.getElementById('albumDetails').textContent = `${artists[0]} & ${artists[1]} • ${albumData.tracks.length} songs`;

            const songList = document.getElementById('songList');
            songList.innerHTML = '';
            albumData.tracks.forEach((track, index) => {
                const track_details = track.split("|");
                
                const songElement = document.createElement('div');
                songElement.className = 'flex items-center p-2 hover:bg-gray-800 rounded';
                songElement.innerHTML = `
                    <span class="w-8 text-right mr-4 text-gray-400">${index + 1}</span>
                    <div class="flex-grow">
                        <p class="font-semibold">${track_details[0]}</p>
                    </div>
                    <span class="text-gray-400">3:30</span>
                `;
                // Add event listeners for tooltip
                songElement.addEventListener('mouseenter', (e) => {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = track_details[1] || 'No description available';
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY + 10}px`;
                    document.body.appendChild(tooltip);
                });

                songElement.addEventListener('mouseleave', () => {
                    const tooltip = document.querySelector('.tooltip');
                    if (tooltip) {
                        tooltip.remove();
                    }
                });
                songList.appendChild(songElement);
            });

            albumContent.classList.remove('hidden');
            updateNavigation();
        }

        function updateNavigation() {
            prevButton.disabled = currentIndex === 0;
            nextButton.disabled = currentIndex === contentResponses.length - 1;
        }

        prevButton.addEventListener('click', () => {
            if (currentIndex > 0) {
                currentIndex--;
                displayAlbum();
            }
        });

        nextButton.addEventListener('click', () => {
            if (currentIndex < contentResponses.length - 1) {
                currentIndex++;
                displayAlbum();
            }
        });

        async function init() {
            try {
                contentResponses = await fetchData();
                loading.classList.add('hidden');
                displayAlbum();
            } catch (error) {
                console.error('Error fetching data:', error);
                loading.textContent = 'Error loading data. Please try again later.';
            }
        }

        init();
    </script>
</body>
</html>